<!DOCTYPE html>
<html>
<head>
  <title>Admin Login</title>
  <style>
    body {
      font-family: Arial;
      background:#f4f6f9;
      margin:0;
    }

    .center {
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
    }

    .box {
      background:white;
      padding:30px;
      border-radius:12px;
      box-shadow:0 4px 15px rgba(0,0,0,0.1);
      text-align:center;
    }

    input {
      padding:10px;
      margin:10px 0;
      width:220px;
    }

    button {
      padding:8px 14px;
      border:none;
      background:#2ecc71;
      color:white;
      border-radius:8px;
      cursor:pointer;
      margin:4px;
    }

    .logout {
      background:#e74c3c;
    }

    .card {
      background:white;
      padding:15px;
      margin:10px 0;
      border-radius:10px;
      box-shadow:0 2px 8px rgba(0,0,0,0.05);
    }

    #adminPanel{
      padding:20px;
      max-width:800px;
      margin:auto;
    }
  </style>
</head>
<body>

<div class="center" id="loginBox">
  <div class="box">
    <h2>üîê Admin Login</h2>
    <input type="password" id="password" placeholder="Enter password">
    <br>
    <button type="button" onclick="login()">Login</button>
  </div>
</div>

<div id="adminPanel" style="display:none;">
  <h1>üìä Dashboard</h1>
  <button class="logout" onclick="logout()">Logout</button>
  <div id="summary"></div>
  <div id="orders"></div>
</div>

<script>
const BASE_URL = "https://topup-backend-1egx.onrender.com";
const ADMIN_PASSWORD = "Aa0819775223";

// üîê ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
window.onload = function(){
  if(localStorage.getItem("adminLoggedIn")==="true"){
    showAdmin();
  }
};

function login(){
  const pass = document.getElementById("password").value;
  if(pass === ADMIN_PASSWORD){
    localStorage.setItem("adminLoggedIn","true");
    showAdmin();
  } else {
    alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î");
  }
}

function logout(){
  localStorage.removeItem("adminLoggedIn");
  location.reload();
}

function showAdmin(){
  document.getElementById("loginBox").style.display="none";
  document.getElementById("adminPanel").style.display="block";
  loadOrders();
}

async function loadOrders(){
  const res = await fetch(BASE_URL + "/orders");
  const orders = await res.json();

  let total = 0;
  let pending = 0;
  let today = 0;
  const todayDate = new Date().toDateString();

  orders.forEach(o=>{
    if(o.status==="approved"){
      total += o.originalAmount;
    }
    if(o.status==="pending"){
      pending++;
    }
    if(new Date(o.createdAt).toDateString()===todayDate){
      today += o.originalAmount;
    }
  });

  document.getElementById("summary").innerHTML = `
    <p>üí∞ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${total} ‡∏ö‡∏≤‡∏ó</p>
    <p>‚è≥ ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥: ${pending} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
    <p>üìÖ ‡∏¢‡∏≠‡∏î‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ: ${today} ‡∏ö‡∏≤‡∏ó</p>
    <hr>
  `;

  const container = document.getElementById("orders");
  container.innerHTML="";

  orders.forEach(order=>{
    container.innerHTML += `
      <div class="card">
        <p><b>Email:</b> ${order.email}</p>
        <p><b>‡∏¢‡∏≠‡∏î:</b> ${order.originalAmount}</p>
        <p><b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</b> ${order.status}</p>

        ${order.slip ? 
  `<button type="button" onclick="window.open('${order.slip}')">‡∏î‡∏π‡∏™‡∏•‡∏¥‡∏õ</button>` 
  : ""}

        ${order.status==="pending" ? 
          `<button type="button" onclick="approve('${order._id}')">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>` 
          : ""}
      </div>
    `;
  });
}

async function approve(id){
  await fetch(BASE_URL + "/approve/" + id, {method:"POST"});
  loadOrders(); // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
}
</script>

</body>
</html>